<html>
 <head>
  <title>Word Cloud Test</title>
  <style type="text/css">
	div#wordcloud {
		position: relative;
	}
	div#wordcloud div.wordclouditem {
		display: inline-block;
		padding: 0.1em;
	}
  </style>
 </head>
 <body>
  <div id="wordcloud"></div>
  <script src="jquery.js"></script>
  <script src="WordFreq.js"></script>
  <script src="http://46.137.24.146/socket.io/socket.io.js"></script>
  <script src="jquery.json.js"></script>
  <script type="text/javascript">
   wordfreq = new WordFreq();
   wordfreq.setEwma(120, 'seconds');
   $.ajax({
		url: "stopwords.txt",
		success: function(text) {
			wordfreq.addStopWords( text.split(/\s+/) );
		},
		error: function(jqXHR, textStatus, errorThrown) {
			alert("Error getting stopwords.txt: "+textStatus);
		}
	});

	wordfreq.registerCallback(function () {1+1;});
  </script>
  <script type="text/javascript">
   supported_actions = ['twitter','facebook','comment'];

   $.getJSON('http://beheer.villavanthilt.be/activities.json?callback=?', function(data) {
		var a = $.parseJSON( data.activities );
		for(var i in a) {
			if( $.inArray( a[i].action, supported_actions) > -1 ) {
				add_words(a[i].message);
			}
		}
   });

   var socket = new io.Socket('46.137.24.146');
   socket.connect();
   socket.on('connect', function(){
		socket.send( $.toJSON({ action: 'join', program: 'all' }) );
   });
   socket.on('disconnect', function(){
		alert('disconected');
		setTimeout("socket.connect();", 1000);
   });
   socket.on('message', function(e){ 
		a = $.parseJSON( e.data );
		if( $.inArray( a.activity.action, supported_actions) > -1 ) {
			add_words( a.activity.message );
		}
   });


   function add_words(text) {
		words = text.match(/http:\/\/[a-zA-Z0-9./?=&-]+|[#@]?[a-zA-Z][a-zA-Z'-]+/g);

		{ // only count unique words, duplicate words in the same comment are ignored
			h = {};
			for(var i in words) { h[words[i]] = 1; }
			words = [];
			for(var i in h) { words.push(i); }
		}

		wordfreq.addWords(words);
   }
  </script>
 </body>
</html>
