<html>
 <head>
  <title>Word Cloud Test</title>
  <style type="text/css">
	div#wordcloud {
		position: relative;
	}
	div#wordcloud div.wordclouditem {
		display: inline-block;
		padding: 0.1em;
	}
  </style>
 </head>
 <body>
  <p>Current time: <span id="now"></span>, next event: <span id="next"></span></p>
  <div id="wordcloud"></div>
  <script src="jquery.js"></script>
  <script src="WordFreq.js"></script>
  <script src="http://46.137.24.146/socket.io/socket.io.js"></script>
  <script src="jquery.json.js"></script>
  <script type="text/javascript">
   wordfreq = new WordFreq();
   wordfreq.setEwma(120, 'seconds');
   $.ajax({
		url: "stopwords.txt",
		success: function(text) {
			wordfreq.addStopWords( text.split(/\s+/) );
		},
		error: function(jqXHR, textStatus, errorThrown) {
			alert("Error getting stopwords.txt: "+textStatus);
		}
	});

	wordfreq.registerCallback(function () {1+1;});
  </script>
  <script type="text/javascript">
   var ffwd = 10;
   var now = 0;
   var events;
   function time_passes() {
		now++;
		// Assume events are sorted
		while( events[0].offset < now ) {
			e = events.shift();
			add_words(e.text);
		}
		$("#now").text(now);
		$("#next").text(events[0].offset);
   }
   $.getJSON('fake_input.json', function(data) {
		events = data;
		setInterval("time_passes();", 1000/ffwd);
   });

   wordfreq = new WordFreq();
   wordfreq.setEwma(300/ffwd, 'seconds');
   $.ajax({
		url: "stopwords.txt",
		success: function(text) {
			wordfreq.addStopWords( text.split(/\s+/) );
		}
	});

   function add_words(text) {
		words = text.match(/http:\/\/[a-zA-Z0-9./?=&-]+|[#@]?[a-zA-Z][a-zA-Z'-]+/g);

		{ // only count unique words, duplicate words in the same comment are ignored
			h = {};
			for(var i in words) { h[words[i]] = 1; }
			words = [];
			for(var i in h) { words.push(i); }
		}

		wordfreq.addWords(words);
   }
  </script>
 </body>
</html>
